<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  {% load i18n %}
  <title>{% trans "Support – Reset Password" %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0b0c0f;--card:#ffffff;--muted:#666;--ok:#0a7c4a;--err:#b00020;--ring:#2563eb}
    *{box-sizing:border-box}
    body{font-family:system-ui,Segoe UI,Arial,sans-serif;background:#f6f7f8;color:#111;margin:0}
    .wrap{max-width:560px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    .card h1{margin:0;padding:20px 20px 0;font-size:1.25rem}
    .card p.sub{margin:6px 20px 0;color:var(--muted);font-size:.92rem}
    .content{padding:18px 20px 22px}
    .banner{border-radius:10px;padding:12px 14px;margin:14px 0;font-size:.95rem}
    .banner.ok{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
    .banner.err{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    .row{margin:12px 0}
    label{display:block;margin:0 0 6px;font-weight:600}
    input{width:100%;padding:11px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;font:inherit}
    input:focus{outline:none;border-color:var(--ring);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
    .help{font-size:.85rem;color:var(--muted);margin-top:6px}
    .errtxt{margin-top:6px;color:var(--err);font-size:.88rem}
    .actions{display:flex;gap:10px;align-items:center;margin-top:6px}
    button{padding:12px 16px;border:0;border-radius:10px;background:var(--ring);color:#fff;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.65;cursor:not-allowed}
    .tiny{font-size:.85rem;color:var(--muted)}
    .pw-wrap{position:relative}
    .toggle-eye{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer;font-size:.9rem;color:#555}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>{% trans "Reset User Password (Support)" %}</h1>
      <p class="sub">{% trans "Enter the user’s phone and a new password. This action is logged." %}</p>

      <div class="content">
        {# Global flash messages #}
        {% if messages %}
          {% for m in messages %}
            <div class="banner {% if 'error' in m.tags %}err{% else %}ok{% endif %}">
              {{ m }}
            </div>
          {% endfor %}
        {% endif %}

        {# Non-field form errors #}
        {% if form.non_field_errors %}
          <div class="banner err">
            {% for e in form.non_field_errors %}{{ e }}<br>{% endfor %}
          </div>
        {% endif %}

        <form method="post" novalidate id="support-reset-form">
          {% csrf_token %}

          <div class="row">
            <label for="{{ form.phone.id_for_label }}">{% trans "Phone" %}</label>
            {{ form.phone }}
            {% if form.phone.errors %}
              <div class="errtxt">
                {% for e in form.phone.errors %}{{ e }}<br>{% endfor %}
              </div>
            {% else %}
              <div class="help">
                {% blocktrans %}Accepts <b>E.164</b> (e.g. <code>+2348012345678</code>) or local NG like <code>080…</code>.{% endblocktrans %}
              </div>
            {% endif %}
          </div>

          <div class="grid-2">
            <div class="row pw-wrap">
              <label for="{{ form.new_password1.id_for_label }}">{% trans "New password" %}</label>
              {{ form.new_password1 }}
              <button type="button"
                      class="toggle-eye"
                      data-target="{{ form.new_password1.id_for_label }}"
                      data-show="{% trans 'Show' %}"
                      data-hide="{% trans 'Hide' %}">
                {% trans "Show" %}
              </button>
              {% if form.new_password1.errors %}
                <div class="errtxt">
                  {% for e in form.new_password1.errors %}{{ e }}<br>{% endfor %}
                </div>
              {% endif %}
            </div>

            <div class="row pw-wrap">
              <label for="{{ form.new_password2.id_for_label }}">{% trans "Confirm password" %}</label>
              {{ form.new_password2 }}
              <button type="button"
                      class="toggle-eye"
                      data-target="{{ form.new_password2.id_for_label }}"
                      data-show="{% trans 'Show' %}"
                      data-hide="{% trans 'Hide' %}">
                {% trans "Show" %}
              </button>
              {% if form.new_password2.errors %}
                <div class="errtxt">
                  {% for e in form.new_password2.errors %}{{ e }}<br>{% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="actions">
            <button type="submit" id="submit-btn">{% trans "Reset password" %}</button>
            <span class="tiny">{% blocktrans %}You must be logged in as <b>staff</b>.{% endblocktrans %}</span>
          </div>
        </form>

        <p class="tiny" style="margin-top:14px">
          {% trans "Tip: Use strong passwords (12+ chars, mix of letters, numbers & symbols). This operation is recorded in the Admin log." %}
        </p>
      </div>
    </div>
  </div>

  <script>
    // Show/Hide password toggles (uses translated labels from data-show/data-hide)
    document.querySelectorAll('.toggle-eye').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-target');
        const input = document.getElementById(id);
        if (!input) return;
        const showing = input.type === 'text';
        input.type = showing ? 'password' : 'text';
        const showTxt = btn.getAttribute('data-show') || 'Show';
        const hideTxt = btn.getAttribute('data-hide') || 'Hide';
        const next = showing ? showTxt : hideTxt;
        btn.textContent = next;
        btn.setAttribute('aria-label', next);
        btn.title = next;
      });
    });

    // Disable button while submitting to prevent double posts
    const form = document.getElementById('support-reset-form');
    const submitBtn = document.getElementById('submit-btn');
    form?.addEventListener('submit', () => {
      submitBtn.disabled = true;
      submitBtn.textContent = '{{ _("Working…") }}';
    });
  </script>
</body>
</html>
