{% extends "base_user.html" %}
{% load static i18n %}

{% block title %}{% trans "Add Payout Address" %}{% endblock %}
{% block page_title %}{% trans "Wallet Address" %}{% endblock %}

{% block breadcrumb %}{% trans "Home" %} / {% trans "My Wallet" %} / {% trans "Add Address" %}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'meta_search/add_address.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}

  <!-- Page header (mobile-only back arrow + title) -->
  <div class="page-with-mobile-back">
    <div class="page-header">
      <a
        class="back-link"
        href="{% url 'withdrawal' %}"
        aria-label="{% trans 'Go back' %}"
        onclick="if (history.length > 1) { history.back(); return false; }">
        <!-- Blue back arrow -->
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             aria-hidden="true">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
      <h1 class="page-title">{% trans "Add Payout Address" %}</h1>
    </div>
  </div>

<section class="wdw">
  <div class="shell">
    <h1>{% trans "Add Payout Address" %}</h1>

    {% if messages %}
      <div class="flash" aria-live="polite">
        {% for message in messages %}
          <div class="alert {{ message.tags|default:'info' }}" role="alert">
            {% if 'success' in message.tags %}
              <i class="fa-solid fa-circle-check"></i>
            {% elif 'error' in message.tags or 'danger' in message.tags %}
              <i class="fa-solid fa-circle-xmark"></i>
            {% elif 'warning' in message.tags %}
              <i class="fa-solid fa-triangle-exclamation"></i>
            {% else %}
              <i class="fa-solid fa-circle-info"></i>
            {% endif %}
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="card">
      <div class="inner">
        <form method="post" action="">
          {% csrf_token %}

          <!-- Address Type -->
          <div class="group">
            <div class="section-title">{% trans "Address Type" %}</div>
            <div class="method" id="methodPills">
              {% for val, label in form.address_type.field.choices %}
                {% if val == 'ETH' or val == 'TRC20' %}
                  {% with is_checked=form.address_type.value|default:form.address_type.initial %}
                    <label class="opt {% if is_checked == val %}active{% endif %}">
                      <input
                        type="radio"
                        name="{{ form.address_type.name }}"
                        value="{{ val }}"
                        class="sr-only"
                        {% if is_checked == val %}checked{% endif %}>
                      {% if val == 'ETH' %}
                        <span class="bullet eth">
                          <i class="fa-brands fa-ethereum" aria-hidden="true"></i>
                        </span>
                        <span>{% trans "Ethereum (ERC20)" %}</span>
                      {% else %}
                        <span class="bullet tether" aria-hidden="true">
                          <svg viewBox="0 0 32 32" role="img" focusable="false" aria-hidden="true">
                            <circle cx="16" cy="16" r="16" fill="#26a17b"></circle>
                            <path fill="#FFFFFF" d="M26 9.9c0-1-4.5-1.9-10-1.9S6 8.9 6 9.9c0 .8 2.7 1.5 6.5 1.8v2.7c-3.7.3-6.2 1-6.2 1.8 0 .8 2.5 1.5 6.2 1.8V24h4.9v-5.9c3.8-.3 6.6-1 6.6-1.9 0-.8-2.8-1.6-6.6-1.9V11.7C23.3 11.4 26 10.7 26 9.9z"/>
                          </svg>
                        </span>
                        <span>{% trans "USDT (TRC20)" %}</span>
                      {% endif %}
                    </label>
                  {% endwith %}
                {% endif %}
              {% endfor %}
            </div>
            {% if form.address_type.errors %}
              <div class="err-row" style="margin-top:8px">
                <i class="fa-solid fa-circle-exclamation"></i>
                {{ form.address_type.errors.0 }}
              </div>
            {% endif %}
          </div>

          <!-- Address -->
          <div class="group addr-wrap">
            <div class="section-title">{% trans "Address" %}</div>

            <div class="addr {% if form.address.errors %}error{% endif %}" id="addrRow">
              {{ form.address }}
            </div>

            <div id="addrHint" class="muted">{% trans "Select a network to see the required format." %}</div>

            <div id="addrClientError" class="err-row" aria-live="polite" hidden>
              <i class="fa-solid fa-circle-exclamation"></i>
              <span></span>
            </div>

            {% if form.address.errors %}
              <div class="err-row" style="margin-top:6px">
                <i class="fa-solid fa-circle-exclamation"></i>
                {{ form.address.errors.0 }}
              </div>
            {% endif %}
          </div>

          <!-- Label -->
          <div class="group">
            <div class="section-title">{% trans "Label (optional)" %}</div>
            {{ form.label }}
            {% if form.label.errors %}
              <div class="err-row" style="margin-top:8px">
                <i class="fa-solid fa-circle-exclamation"></i>
                {{ form.label.errors.0 }}
              </div>
            {% endif %}
          </div>

          <!-- Actions -->
          <div class="group" style="display:flex;gap:10px;justify-content:center">
            <button class="submit" type="submit">{% trans "Save Address" %}</button>
            <a href="{% url 'withdrawal' %}" class="submit" style="background:#6b7280;border-color:#6b7280;">{% trans "Back" %}</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  // Replace inline messages with gettext translations if needed:
  // Example:
  // const hints = {
  //   ETH: "{% trans 'Ethereum address must start with 0x and be 42 characters total (0x + 40 hex).' %}",
  //   TRC20: "{% trans 'TRC20 address must start with T and be 34 characters (Base58).' %}"
  // };
</script>
{% endblock %}
