{% extends "base_admin.html" %}
{% block title %}Admin · Users{% endblock %}
{% block page_title %}Users{% endblock %}

{% block extra_head %}
<style>
  /* ================= Admin · Users (page-scoped styles) ================= */

  /* Flash messages */
  .messages{ list-style:none; padding:0; margin:0 0 12px; display:grid; gap:8px; }
  .messages li{
    padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:#fff; font-weight:600; font-size:14px;
  }
  .messages li.success{ border-color:#bbf7d0; background:#f0fdf4; color:#166534; }
  .messages li.warning{ border-color:#fde68a; background:#fffbeb; color:#92400e; }
  .messages li.error{ border-color:#fecaca; background:#fef2f2; color:#7f1d1d; }
  .messages li.info{ border-color:#bfdbfe; background:#eff6ff; color:#1e3a8a; }

  /* Filter form */
  .filter-card{ padding:14px; }
  .filter-grid{
    display:grid; gap:10px;
    grid-template-columns: 2fr 1fr auto;
    align-items:end;
  }
  @media (max-width: 900px){
    .filter-grid{ grid-template-columns: 1fr; align-items:stretch; }
  }
  .field{ display:flex; flex-direction:column; gap:6px; }
  .field label{ font-weight:600; font-size:13px; color:#111827; }
  .input, .select, .checkbox-line{
    border:1px solid var(--border); background:#fff; border-radius:12px;
    padding:10px 12px; font:inherit; width:100%;
  }
  .checkbox-wrap{
    display:flex; align-items:center; gap:10px;
    border:1px solid var(--border); background:#fff; border-radius:12px;
    padding:10px 12px;
  }
  .checkbox-wrap input{ width:18px; height:18px; }

  /* Table */
  .table-card{ padding:0; }
  .table-responsive{ overflow-x:auto; }
  .tbl{ width:100%; border-collapse:collapse; }
  .tbl thead th{
    text-align:left; padding:12px; font-size:13px; font-weight:700; color:#111827;
    background:#f8fafc; border-bottom:1px solid var(--border);
    position:sticky; top:0; z-index:1;
  }
  .tbl td{
    padding:12px; border-top:1px solid var(--border);
    vertical-align:top;
  }
  .tbl .actions{ display:flex; gap:8px; flex-wrap:wrap; }

  /* Mobile transform: table -> cards */
  @media (max-width: 760px){
    .table-responsive{ overflow:visible; }
    .tbl thead{ display:none; }
    .tbl tbody tr{
      display:grid; gap:8px; padding:12px;
      border-top:1px solid var(--border);
    }
    .tbl tbody tr:first-child{ border-top:none; }
    .tbl td{
      border:none; padding:0;
      display:flex; gap:10px; align-items:flex-start;
    }
    .tbl td::before{
      content: attr(data-label);
      flex: 0 0 110px;
      font-weight:600; color:#6b7280;
    }
    .tbl td[data-label="Details"]{ margin-top:6px; }
    .tbl td[data-label="Details"] .actions{ width:100%; }
  }

  /* Buttons */
  .btn.small{ padding:8px 10px; border-radius:10px; font-size:13px; }
</style>
{% endblock %}

{% block content %}
{% if messages %}
  <ul class="messages">{% for m in messages %}<li class="{{ m.tags }}">{{ m }}</li>{% endfor %}</ul>
{% endif %}

<form method="get" class="card filter-card" role="search">
  <div class="filter-grid">
    <div class="field">
      <label for="q">Search</label>
      <input id="q" class="input" type="text" name="q" value="{{ q }}" placeholder="phone / nickname / email">
    </div>

    <div class="field">
      <label>&nbsp;</label>
      <div class="checkbox-wrap">
        <input id="blocked" type="checkbox" name="blocked" value="1" {% if blocked %}checked{% endif %}>
        <label for="blocked" style="margin:0; font-weight:600; cursor:pointer;">Blocked only</label>
      </div>
    </div>

    <div class="field">
      <label>&nbsp;</label>
      <button class="btn primary" type="submit" style="width:100%;">Filter</button>
    </div>
  </div>
</form>

<div class="card table-card">
  <div class="table-responsive">
    <table class="tbl">
      <thead>
        <tr>
          <th>#</th>
          <th>User</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Joined</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        {% for u in page_obj %}
          <tr>
            <td data-label="#">{{ u.id }}</td>
            <td data-label="User">{{ u }}</td>
            <td data-label="Phone">{{ u.phone|default:"—" }}</td>
            <td data-label="Email">{{ u.email|default:"—" }}</td>
            <td data-label="Joined">{{ u.date_joined }}</td>
            <td data-label="Details">
              <div class="actions">
                <a class="btn small" href="{% url 'bo_user_detail' u.id %}">Open</a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" style="padding:16px;">No users.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% include "meta_search/bo/_pagination.html" with page_obj=page_obj %}
{% endblock %}
