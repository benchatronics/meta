{% extends "base_user.html" %}
{% load static %}

{% block title %}Deposit{% endblock %}
{% block breadcrumb %}Home / my Wallet / Deposit{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'meta_search/deposit.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block content %}

  <!-- Page header (mobile-only back arrow + title) -->
  <div class="page-with-mobile-back">
    <div class="page-header">
      <a
        class="back-link"
        href="{% url 'wallet' %}"                 {# fallback route; change if needed #}
        aria-label="Go back"
        onclick="if (history.length > 1) { history.back(); return false; }">
        <!-- Blue back arrow (uses currentColor) -->
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             aria-hidden="true">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
      <h1 class="page-title">Deposit</h1>        {# change title per page #}
    </div>

    <!-- rest of your page content here... -->
  </div>

  <!-- Scoped, page-only CSS -->
  <style>
    /* scope all rules to this page only */
    .page-with-mobile-back .page-header{
      display:flex; align-items:center; gap:10px;
      margin:0 0 14px;
    }
    .page-with-mobile-back .page-title{
      margin:0; font-weight:700; font-size:22px;
      color:var(--text, #0f172a);
    }

    /* Back arrow (mobile-only) */
    .page-with-mobile-back .back-link{
      display:none;                               /* hidden by default (desktop) */
      align-items:center; justify-content:center;
      width:36px; height:36px;
      border-radius:10px;
      border:1px solid var(--border, #e5e7eb);
      background:#fff;
      color:var(--primary, #2451FF);              /* BLUE arrow via currentColor */
      text-decoration:none;
      box-shadow:0 1px 0 rgba(16,24,40,.02);
    }
    .page-with-mobile-back .back-link:hover{
      box-shadow:0 8px 20px rgba(16,24,40,.08);
    }

    /* Show the back arrow only on mobile/tablet */
    @media (max-width: 900px){
      .page-with-mobile-back .back-link{ display:inline-flex; }
      .page-with-mobile-back .page-title{ font-size:20px; }
      .page-with-mobile-back .back-link svg{ width:18px; height:18px; }
    }
  </style>
<section class="dep">
  <div class="shell">
    <h1></h1>

    {# Django messages #}
    {% if messages %}
      <div class="alerts" role="status" aria-live="polite">
        {% for message in messages %}
          <div class="alert {{ message.tags|default:'info' }}">
            {% if 'success' in message.tags %}<i class="fa-regular fa-circle-check"></i>{% endif %}
            {% if 'info' in message.tags or not message.tags %}<i class="fa-regular fa-circle-info"></i>{% endif %}
            {% if 'warning' in message.tags %}<i class="fa-regular fa-triangle-exclamation"></i>{% endif %}
            {% if 'error' in message.tags %}<i class="fa-regular fa-circle-xmark"></i>{% endif %}
            <div>{{ message }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="card">
      <div class="inner grid">
        <form method="post" action="{% url 'deposit' %}" id="depositForm" novalidate>
          {% csrf_token %}

          {# Non-field errors #}
          {% if form.non_field_errors %}
            <div class="group">
              <div class="field-error">{{ form.non_field_errors|join:", " }}</div>
            </div>
          {% endif %}

          <!-- Amount + Currency -->
          <div class="group">
            <div class="section-title">Amount</div>

            <div class="ctrl {% if form.amount.errors %}error{% endif %}">
              <span class="prefix" id="currSymbol">{{ symbol }}</span>
              {{ form.amount }}
              <div class="select {% if form.currency.errors %}error{% endif %}">
                {{ form.currency }}
              </div>
            </div>

            {% if form.amount.errors %}
              <div class="field-error">{{ form.amount.errors.0 }}</div>
            {% endif %}
            {% if form.currency.errors %}
              <div class="field-error">{{ form.currency.errors.0 }}</div>
            {% endif %}

            <!-- Preset chips -->
            <div class="chips">
              {% for v in presets %}
                <button class="chip" type="button" data-amt="{{ v }}">{{ v }}</button>
              {% endfor %}
            </div>

            <div class="muted">Minimum 10. Choose a preset or enter an amount.</div>
          </div>

          <!-- Network / Payment method -->
          <div class="group">
            <div class="section-title" style="margin-top:10px">Payment Method</div>
            <div class="method">
              <!-- Ethereum -->
              <label class="opt {% if form.network.value == 'ETH' %}active{% endif %}" data-net="ETH">
                <input type="radio" name="network" value="ETH" class="sr-only" {% if form.network.value == 'ETH' or not form.network.value %}checked{% endif %}>
                <span class="bullet"><i class="fa-brands fa-ethereum"></i></span>
                <span>Ethereum (ERC20)</span>
              </label>

              <!-- USDT TRC20 (Green with bold white T) -->
              <label class="opt {% if form.network.value == 'TRC20' %}active{% endif %}" data-net="TRC20">
                <input type="radio" name="network" value="TRC20" class="sr-only" {% if form.network.value == 'TRC20' %}checked{% endif %}>
                <span class="bullet usdt">T</span>
                <span>USDT (TRC20)</span>
              </label>
            </div>

            {% if form.network.errors %}
              <div class="field-error">{{ form.network.errors.0 }}</div>
            {% endif %}
          </div>

          <!-- Submit -->
          <div class="group">
            <button class="submit" type="submit">Proceed to Pay →</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
  // Auto-dismiss non-error alerts after 6s
  setTimeout(() => {
    document.querySelectorAll('.dep .alert:not(.error)').forEach(el => {
      el.style.transition = 'opacity .3s ease';
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 300);
    });
  }, 6000);

  // Currency symbol swap
  (function(){
    const symbolMap = { EUR:"€", USD:"$", GBP:"£", NGN:"₦" };
    const currSel = document.querySelector('.dep select[name="currency"]');
    const sym = document.getElementById('currSymbol');
    if (currSel && sym){
      sym.textContent = symbolMap[currSel.value] || sym.textContent || "€";
      currSel.addEventListener('change', ()=>{ sym.textContent = symbolMap[currSel.value] || sym.textContent || "€"; });
    }
  })();

  // Preset chips -> fill amount
  document.querySelectorAll('.dep .chip').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      const i = document.querySelector('.dep input[name="amount"], .dep input#id_amount');
      if (i) i.value = Number(ch.dataset.amt).toFixed(2);
    });
  });

  // Toggle network highlight
  document.querySelectorAll('.dep .opt').forEach(label=>{
    const input = label.querySelector('input[type="radio"]');
    label.addEventListener('click', ()=>{
      document.querySelectorAll('.dep .opt').forEach(l=>l.classList.remove('active'));
      label.classList.add('active');
      if (input) input.checked = true;
    });
  });
</script>
{% endblock %}
