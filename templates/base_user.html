{# meta_search/base_user_layout.css #}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}My Wallet{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Main layout styles -->
  <link rel="stylesheet" href="{% static 'meta_search/base_user_layout.css' %}">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <div class="app {% block app_classes %}{% endblock %}" id="app">
    <!-- Sidebar (fixed menu) -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <a class="brand-button" href="{% url 'user_dashboard' %}" title="Dashboard">
          <img src="{% static 'meta_search/images/logo_emoji.png' %}" alt="Dashboard" style="width:20px; height:20px; vertical-align:middle;">
        </a>
        <div class="brand-name"></div>

        <!-- NEW: Desktop-only toggle lives in the sidebar -->
        <button class="sb-toggle sb-toggle-desktop" id="sbToggleDesktop" aria-label="Collapse menu" title="Collapse">¬´</button>
      </div>

      <!-- User info (avatar + meta) -->
      {% static 'meta_search/images/avatar-placeholder.png' as avatar_placeholder %}
      <div class="profile"
           title="{{ request.user.nickname|default:request.user.get_full_name|default:request.user.username }}">
        <div class="avatar">
          {# Prefer uploaded file, then URL field, then placeholder #}
          {% if request.user.avatar %}
            <img src="{{ request.user.avatar.url }}" alt="User avatar" width="48" height="48" loading="lazy" onerror="this.src='{{ avatar_placeholder }}'">
          {% elif request.user.avatar_url %}
            <img src="{{ request.user.avatar_url }}" alt="User avatar" width="48" height="48" loading="lazy" onerror="this.src='{{ avatar_placeholder }}'">
          {% else %}
            <img src="{{ avatar_placeholder }}" alt="User avatar" width="48" height="48" loading="lazy">
          {% endif %}
          <span class="status-dot"></span>
        </div>
        <div class="meta">
          <div class="id">User ID: {{ request.user.id }}</div>
          <div class="phone">Phone: {{ request.user.phone|default:'-' }}</div>
        </div>
      </div>

      <!-- Nav -->
      <nav class="nav" aria-label="Sidebar">
        <a class="link {% if active_page == 'home' %}active{% endif %}" href="{% url 'user_dashboard' %}" title="Home">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10.5 12 3l9 7.5"/><path d="M5 10v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-9"/></svg>
          <span class="label">Home</span>
        </a>
        <a class="link {% if active_page == 'task' %}active{% endif %}" href="{% url 'task_dashboard' %}" title="Task">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M7 8h10M7 12h6"/></svg>
          <span class="label">Task</span>
        </a>
        <a class="link {% if active_page == 'rewards' %}active{% endif %}" href="#" title="Rewards">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 17 3 3 7-7"/><path d="M20 10V7a2 2 0 0 0-2-2H6a2 2 0 0 0 2 2v10a2 2 0 0 0 2 2h6"/></svg>
          <span class="label">Rewards</span>
        </a>

        <h6>Account</h6>

        <a class="link {% if active_page == 'wallet' %}active{% endif %}" href="{% url 'wallet' %}" title="My Wallet">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg>
          <span class="label">My Wallet</span>
        </a>
        <a class="link {% if active_page == 'settings' %}active{% endif %}" href="{% url 'profile_settings' %}" title="Settings">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 15l-3 3 3 3"/><path d="M9 18h9a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3H8a3 3 0 0 0-3 3v9"/></svg>
          <span class="label">Settings</span>
        </a>
        <a class="link {% if active_page == 'info' %}active{% endif %}" href="{% url 'info_index' %}" title="Info">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
          <span class="label">Info</span>
        </a>

        <div class="bottom">
          <a class="link" href="{% url 'signout' %}" title="Logout">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <span class="label">Logout</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main panel -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="breadcrumb">
          <span class="crumb-home">üè†</span>

          <!-- MOBILE-ONLY TOGGLE (drawer) -->
          <button class="sb-toggle sb-toggle-mobile" id="sbToggleMobile" aria-label="Menu" title="Menu">‚ò∞</button>

          <!-- Breadcrumb / centered logo on very small screens -->
          <span class="dreadcrumb">
            {% block breadcrumb %}Home / setting / my wallet{% endblock %}
          </span>

          <style>
            @media (max-width: 620px){
              .topbar .breadcrumb { position: relative; }
              .topbar .breadcrumb .dreadcrumb{
                position: absolute;
                left: 420%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 120px;
                height: 28px;
                font-size: 0;
                color: transparent;
                line-height: 0;
                pointer-events: none;
              }
              .topbar .breadcrumb .dreadcrumb::before{
                content: "";
                display: block;
                width: 100%;
                height: 100%;
                background: url("{% static 'meta_search/logos/arrow-icon3.png' %}") no-repeat center;
                background-size: contain;
              }
            }
          </style>
        </div>

        <div class="bell" title="Announcements">
          <a href="{% url 'announcements' %}" aria-label="Announcements">üîî</a>
          {# Optional badge: <span class="badge">3</span> #}
        </div>
      </div>

      <!-- Page content -->
      {% block content %}{% endblock %}
    </main>
  </div>

  {% block extra_scripts %}
  <script>
    // ===== Collapse & Mobile Off-canvas (two toggles) =====
    const appEl = document.getElementById('app');
    const sbToggleDesktop = document.getElementById('sbToggleDesktop'); // desktop: collapse
    const sbToggleMobile  = document.getElementById('sbToggleMobile');  // mobile: drawer

    function isMobile(){ return window.matchMedia('(max-width: 900px)').matches; }

    function setCollapsed(collapsed){
      appEl.classList.toggle('collapsed', !!collapsed);
      if (sbToggleDesktop){
        sbToggleDesktop.textContent = collapsed ? '‚ò∞' : '‚ò∞';
        sbToggleDesktop.setAttribute('title', collapsed ? 'Expand' : 'Collapse');
      }
      try { localStorage.setItem('sb_collapsed', collapsed ? '1' : '0'); } catch(e){}
    }

    try {
      const saved = localStorage.getItem('sb_collapsed');
      if (saved === '1' && !isMobile()) setCollapsed(true);
    } catch(e){}

    sbToggleDesktop?.addEventListener('click', (e) => {
      e.stopPropagation();
      if (isMobile()) return;
      setCollapsed(!appEl.classList.contains('collapsed'));
    });

    sbToggleMobile?.addEventListener('click', (e) => {
      e.stopPropagation();
      if (!isMobile()) return;
      appEl.classList.toggle('nav-open');
    });

    document.addEventListener('click', (e) => {
      if (!appEl.classList.contains('nav-open')) return;
      const sidebar = document.getElementById('sidebar');
      if ((sidebar && sidebar.contains(e.target)) || e.target.closest('#sbToggleMobile')) return;
      appEl.classList.remove('nav-open');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') appEl.classList.remove('nav-open');
    });

    document.querySelectorAll('.nav .link').forEach(a=>{
      a.addEventListener('click', ()=>{
        if (isMobile()) appEl.classList.remove('nav-open');
      });
    });

    const mq = window.matchMedia('(max-width: 900px)');
    if (mq.addEventListener) {
      mq.addEventListener('change', () => {
        if (mq.matches) {
          appEl.classList.remove('collapsed');
          if (sbToggleMobile) sbToggleMobile.textContent = '‚ò∞';
        } else {
          appEl.classList.remove('nav-open');
          try { if (localStorage.getItem('sb_collapsed') === '1') setCollapsed(true); } catch(e){}
        }
      });
    }
  </script>
    
  <!-- ======== MOBILE BOTTOM NAV ======== -->
  <nav class="mobile-bottom-nav" role="tablist" aria-label="Primary">
    <a class="{% if active_page == 'home' %}active{% endif %}" href="{% url 'user_dashboard' %}" title="Home" role="tab" aria-selected="{% if active_page == 'home' %}true{% else %}false{% endif %}">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M3 10.5 12 3l9 7.5"/><path d="M5 10v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-9"/>
      </svg>
      <span>Home</span>
      <span class="dot" aria-hidden="true"></span>
    </a>
    <a class="{% if active_page == 'task' %}active{% endif %}" href="{% url 'task_dashboard' %}" title="Tasks" role="tab" aria-selected="{% if active_page == 'task' %}true{% else %}false{% endif %}">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="3" y="4" width="18" height="14" rx="2"/><path d="M7 8h10M7 12h6"/>
      </svg>
      <span>Tasks</span>
      <span class="dot" aria-hidden="true"></span>
    </a>

    <a class="{% if active_page == 'rewards' %}active{% endif %}" href="#" title="Reward" role="tab" aria-selected="{% if active_page == 'rewards' %}true{% else %}false{% endif %}">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="m12 17 3 3 7-7"/><path d="M20 10V7a2 2 0 0 0-2-2H6a2 2 0 0 0 2 2v10a2 2 0 0 0 2 2h6"/>
      </svg>
      <span>Reward</span>
      <span class="dot" aria-hidden="true"></span>
    </a>

    <a class="{% if active_page == 'wallet' %}active{% endif %}" href="{% url 'wallet' %}" title="Wallet" role="tab" aria-selected="{% if active_page == 'wallet' %}true{% else %}false{% endif %}">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/>
      </svg>
      <span>Wallet</span>
      <span class="dot" aria-hidden="true"></span>
    </a>
  </nav>
  <!-- ======== /MOBILE BOTTOM NAV ======== -->

  {% endblock %}
</body>
</html>
