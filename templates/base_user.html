{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}My Wallet{% endblock %}</title>

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Main layout styles -->
  <link rel="stylesheet" href="{% static 'meta_search/base_user_layout.css' %}">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <div class="app {% block app_classes %}{% endblock %}" id="app">
    <!-- Sidebar (fixed menu) -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="brand-button" title="Dashboard">‚Üó</div>
        <div class="brand-name"> </div>

        <!-- Collapse toggle (dash menu behavior INSIDE the sidebar) -->
        <button class="sb-toggle" id="sbToggle" aria-label="Collapse sidebar" title="Collapse">
          <!-- chevrons -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
      </div>

      <!-- User info (avatar + meta) -->
      <div class="profile" title="{{ request.user.get_full_name|default:request.user.username }}">
        <div class="avatar">
          <img
            src="{% firstof user_avatar request.user.profile.avatar.url static 'images/avatar-placeholder.jpg' %}"
            alt="User avatar"
            onerror="this.src='{% static 'meta_search/images/avatar-placeholder.png' %}'">
          <span class="status-dot"></span>
        </div>
        <div class="meta">
          <div class="id">User ID: {{ request.user.id }}</div>
          <div class="phone">Phone: {{ request.user.phone|default:'-' }}</div>
        </div>
      </div>

      <!-- Nav -->
      <nav class="nav">
        <a class="link {% if active_page == 'home' %}active{% endif %}" href="{% url 'user_dashboard' %}" title="Home">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10.5 12 3l9 7.5"/><path d="M5 10v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-9"/></svg>
          <span class="label">Home</span>
        </a>
        <a class="link {% if active_page == 'task' %}active{% endif %}" href="#" title="Task">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M7 8h10M7 12h6"/></svg>
          <span class="label">Task</span>
        </a>
        <a class="link {% if active_page == 'rewards' %}active{% endif %}" href="#" title="Rewards">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 17 3 3 7-7"/><path d="M20 10V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6"/></svg>
          <span class="label">Rewards</span>
        </a>

        <h6>Account</h6>

        <a class="link {% if active_page == 'wallet' %}active{% endif %}" href="{% url 'wallet' %}" title="My Wallet">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg>
          <span class="label">My Wallet</span>
        </a>
        <a class="link {% if active_page == 'settings' %}active{% endif %}" href="#" title="Settings">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 15l-3 3 3 3"/><path d="M9 18h9a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3H8a3 3 0 0 0-3 3v9"/></svg>
          <span class="label">Settings</span>
        </a>
        <a class="link {% if active_page == 'info' %}active{% endif %}" href="#" title="Info">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
          <span class="label">Info</span>
        </a>

        <div class="bottom">
          <a class="link" href="{% url 'signout' %}" title="Logout">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <span class="label">Logout</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main panel -->
    <main class="main">
      <!-- Single topbar (no duplicates) -->
      <div class="topbar">
        <div class="breadcrumb">
          <span class="crumb-home">üè†</span>
          <span>{% block breadcrumb %}Home / setting / my wallet{% endblock %}</span>
        </div>
        <div class="bell" title="Notifications">üîî</div>
      </div>

      <!-- Page content -->
      {% block content %}{% endblock %}
    </main>
  </div>

  {% block extra_scripts %}
  <script>
    // Collapse behavior (dash menu inside sidebar)
    const appEl = document.getElementById('app');
    const sbToggle = document.getElementById('sbToggle');

    function setCollapsed(collapsed){
      appEl.classList.toggle('collapsed', !!collapsed);
      // flip chevron direction
      const svg = sbToggle.querySelector('svg');
      if (!svg) return;
      if (collapsed) {
        svg.innerHTML = '<polyline points="9 18 15 12 9 6"></polyline>'; // chevron >>
      } else {
        svg.innerHTML = '<polyline points="15 18 9 12 15 6"></polyline>'; // chevron <<
      }
      sbToggle.setAttribute('title', collapsed ? 'Expand' : 'Collapse');
      try { localStorage.setItem('sb_collapsed', collapsed ? '1' : '0'); } catch(e){}
    }

    // restore last state
    try {
      const saved = localStorage.getItem('sb_collapsed');
      if (saved === '1') setCollapsed(true);
    } catch(e){}

    sbToggle?.addEventListener('click', () => {
      setCollapsed(!appEl.classList.contains('collapsed'));
    });
  </script>
  {% endblock %}
</body>
</html>
