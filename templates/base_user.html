{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}My Wallet{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Main layout styles -->
  <link rel="stylesheet" href="{% static 'meta_search/base_user_layout.css' %}">
  {% block extra_head %}{% endblock %}

  <style>
    /* tiny helpers for inline SVG icons */
    .icon{width:18px;height:18px;display:inline-block;vertical-align:-2px}
    .icon.sm{width:16px;height:16px}
    .icon.lg{width:20px;height:20px}
    .text-ink{color:#1b1b1b}
  </style>
</head>
<body>

  <!-- ===== Inline SVG SPRITE (your icons) — available site-wide ===== -->
  <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden">
    <!-- home -->
    <symbol id="i-home" viewBox="0 0 24 24">
      <path d="M8 17H16M11.0177 2.764L4.23539 8.03912C3.78202 8.39175 3.55534 8.56806 3.39203 8.78886C3.24737 8.98444 3.1396 9.20478 3.07403 9.43905C3 9.70352 3 9.9907 3 10.5651V17.8C3 18.9201 3 19.4801 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4801 21 18.9201 21 17.8V10.5651C21 9.9907 21 9.70352 20.926 9.43905C20.8604 9.20478 20.7526 8.98444 20.608 8.78886C20.4447 8.56806 20.218 8.39175 19.7646 8.03913L12.9823 2.764C12.631 2.49075 12.4553 2.35412 12.2613 2.3016C12.0902 2.25526 11.9098 2.25526 11.7387 2.3016C11.5447 2.35412 11.369 2.49075 11.0177 2.764Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- task -->
    <symbol id="i-task" viewBox="0 0 24 24">
      <path d="M9 18.5H15M7 15H17M5 2H19C20.1046 2 21 2.99492 21 4.22222V19.7778C21 21.0051 20.1046 22 19 22H5C3.89543 22 3 21.0051 3 19.7778V4.22222C3 2.99492 3.89543 2 5 2ZM11.9976 6.21194C11.2978 5.4328 10.1309 5.22321 9.25414 5.93667C8.37738 6.65013 8.25394 7.84299 8.94247 8.6868C9.631 9.53061 11.9976 11.5 11.9976 11.5C11.9976 11.5 14.3642 9.53061 15.0527 8.6868C15.7413 7.84299 15.6329 6.64262 14.7411 5.93667C13.8492 5.23072 12.6974 5.4328 11.9976 6.21194Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- rewards -->
    <symbol id="i-reward" viewBox="0 0 24 24">
      <path d="M12 6V22M12 6H8.46429C7.94332 6 7.4437 5.78929 7.07533 5.41421C6.70695 5.03914 6.5 4.53043 6.5 4C6.5 3.46957 6.70695 2.96086 7.07533 2.58579C7.4437 2.21071 7.94332 2 8.46429 2C11.2143 2 12 6 12 6ZM12 6H15.5357C16.0567 6 16.5563 5.78929 16.9247 5.41421C17.293 5.03914 17.5 4.53043 17.5 4C17.5 3.46957 17.293 2.96086 16.9247 2.58579C16.5563 2.21071 16.0567 2 15.5357 2C12.7857 2 12 6 12 6ZM20 11V18.8C20 19.9201 20 20.4802 19.782 20.908C19.5903 21.2843 19.2843 21.5903 18.908 21.782C18.4802 22 17.9201 22 16.8 22L7.2 22C6.07989 22 5.51984 22 5.09202 21.782C4.71569 21.5903 4.40973 21.2843 4.21799 20.908C4 20.4802 4 19.9201 4 18.8V11M2 7.6L2 9.4C2 9.96005 2 10.2401 2.10899 10.454C2.20487 10.6422 2.35785 10.7951 2.54601 10.891C2.75992 11 3.03995 11 3.6 11L20.4 11C20.9601 11 21.2401 11 21.454 10.891C21.6422 10.7951 21.7951 10.6422 21.891 10.454C22 10.2401 22 9.96005 22 9.4V7.6C22 7.03995 22 6.75992 21.891 6.54601C21.7951 6.35785 21.6422 6.20487 21.454 6.10899C21.2401 6 20.9601 6 20.4 6L3.6 6C3.03995 6 2.75992 6 2.54601 6.10899C2.35785 6.20487 2.20487 6.35785 2.10899 6.54601C2 6.75992 2 7.03995 2 7.6Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- wallet -->
    <symbol id="i-wallet" viewBox="0 0 24 24">
      <path d="M20 9.5V7.2C20 6.0799 20 5.51984 19.782 5.09202C19.5903 4.7157 19.2843 4.40974 18.908 4.21799C18.4802 4 17.9201 4 16.8 4H5.2C4.0799 4 3.51984 4 3.09202 4.21799C2.7157 4.40973 2.40973 4.71569 2.21799 5.09202C2 5.51984 2 6.0799 2 7.2V16.8C2 17.9201 2 18.4802 2.21799 18.908C2.40973 19.2843 2.71569 19.5903 3.09202 19.782C3.51984 20 4.07989 20 5.2 20L16.8 20C17.9201 20 18.4802 20 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C20 18.4802 20 17.9201 20 16.8V14.5M15 12C15 11.5353 15 11.303 15.0384 11.1098C15.1962 10.3164 15.8164 9.69624 16.6098 9.53843C16.803 9.5 17.0353 9.5 17.5 9.5H19.5C19.9647 9.5 20.197 9.5 20.3902 9.53843C21.1836 9.69624 21.8038 10.3164 21.9616 11.1098C22 11.303 22 11.5353 22 12C22 12.4647 22 12.697 21.9616 12.8902C21.8038 13.6836 21.1836 14.3038 20.3902 14.4616C20.197 14.5 19.9647 14.5 19.5 14.5H17.5C17.0353 14.5 16.803 14.5 16.6098 14.4616C15.8164 14.3038 15.1962 13.6836 15.0384 12.8902C15 12.697 15 12.4647 15 12Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- info -->
    <symbol id="i-info" viewBox="0 0 24 24">
      <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- settings -->
    <symbol id="i-settings" viewBox="0 0 24 24">
      <path d="M9.39504 19.3711L9.97949 20.6856C10.1532 21.0768 10.4368 21.4093 10.7957 21.6426C11.1547 21.8759 11.5736 22.0001 12.0017 22C12.4298 22.0001 12.8488 21.8759 13.2077 21.6426C13.5667 21.4093 13.8502 21.0768 14.0239 20.6856L14.6084 19.3711C14.8164 18.9047 15.1664 18.5159 15.6084 18.26C16.0532 18.0034 16.5677 17.8941 17.0784 17.9478L18.5084 18.1C18.934 18.145 19.3636 18.0656 19.7451 17.8713C20.1265 17.6771 20.4434 17.3763 20.6573 17.0056C20.8714 16.635 20.9735 16.2103 20.951 15.7829C20.9285 15.3555 20.7825 14.9438 20.5306 14.5978L19.6839 13.4344C19.3825 13.0171 19.2214 12.5148 19.2239 12C19.2238 11.4866 19.3864 10.9864 19.6884 10.5711L20.535 9.40778C20.7869 9.06175 20.933 8.65007 20.9554 8.22267C20.9779 7.79528 20.8759 7.37054 20.6617 7C20.4478 6.62923 20.1309 6.32849 19.7495 6.13423C19.3681 5.93997 18.9385 5.86053 18.5128 5.90556L17.0828 6.05778C16.5722 6.11141 16.0576 6.00212 15.6128 5.74556C15.1699 5.48825 14.8199 5.09736 14.6128 4.62889L14.0239 3.31444C13.8502 2.92317 13.5667 2.59072 13.2077 2.3574C12.8488 2.12408 12.4298 1.99993 12.0017 2C11.5736 1.99993 11.1547 2.12408 10.7957 2.3574C10.4368 2.59072 10.1532 2.92317 9.97949 3.31444L9.39504 4.62889C9.18797 5.09736 8.83792 5.48825 8.39504 5.74556C7.95026 6.00212 7.43571 6.11141 6.92504 6.05778L5.4906 5.90556C5.06493 5.86053 4.63534 5.93997 4.25391 6.13423C3.87249 6.32849 3.55561 6.62923 3.34171 7C3.12753 7.37054 3.02549 7.79528 3.04798 8.22267C3.07046 8.65007 3.2165 9.06175 3.46838 9.40778L4.31504 10.5711C4.61698 10.9864 4.77958 11.4866 4.77949 12C4.77958 12.5134 4.61698 13.0137 4.31504 13.4289L3.46838 14.5922C3.2165 14.9382 3.07046 15.3499 3.04798 15.7773C3.02549 16.2047 3.12753 16.6295 3.34171 17C3.55582 17.3706 3.87274 17.6712 4.25411 17.8654C4.63548 18.0596 5.06496 18.1392 5.4906 18.0944L6.9206 17.9422C7.43127 17.8886 7.94581 17.9979 8.3906 18.2544C8.83513 18.511 9.18681 18.902 9.39504 19.3711Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M11.9999 15C13.6568 15 14.9999 13.6569 14.9999 12C14.9999 10.3431 13.6568 9 11.9999 9C10.3431 9 8.99992 10.3431 8.99992 12C8.99992 13.6569 10.3431 15 11.9999 15Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- logout -->
    <symbol id="i-logout" viewBox="0 0 24 24">
      <path d="M16 17L21 12M21 12L16 7M21 12H9M12 17C12 17.2956 12 17.4434 11.989 17.5714C11.8748 18.902 10.8949 19.9968 9.58503 20.2573C9.45903 20.2823 9.31202 20.2987 9.01835 20.3313L7.99694 20.4448C6.46248 20.6153 5.69521 20.7005 5.08566 20.5055C4.27293 20.2454 3.60942 19.6515 3.26118 18.8725C3 18.2882 3 17.5162 3 15.9723V8.0277C3 6.48377 3 5.7118 3.26118 5.12752C3.60942 4.34848 4.27293 3.7546 5.08566 3.49453C5.69521 3.29947 6.46246 3.38472 7.99694 3.55522L9.01835 3.66871C9.31212 3.70135 9.45901 3.71767 9.58503 3.74273C10.8949 4.00316 11.8748 5.09804 11.989 6.42861C12 6.55663 12 6.70442 12 7"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- notifications -->
    <symbol id="i-bell" viewBox="0 0 24 24">
      <path d="M14.9997 19C14.9997 20.6569 13.6566 22 11.9997 22C10.3429 22 8.99972 20.6569 8.99972 19M13.7962 6.23856C14.2317 5.78864 14.4997 5.17562 14.4997 4.5C14.4997 3.11929 13.3804 2 11.9997 2C10.619 2 9.49972 3.11929 9.49972 4.5C9.49972 5.17562 9.76772 5.78864 10.2032 6.23856M17.9997 11.2C17.9997 9.82087 17.3676 8.49823 16.2424 7.52304C15.1171 6.54786 13.591 6 11.9997 6C10.4084 6 8.8823 6.54786 7.75708 7.52304C6.63186 8.49823 5.99972 9.82087 5.99972 11.2C5.99972 13.4818 5.43385 15.1506 4.72778 16.3447C3.92306 17.7056 3.5207 18.3861 3.53659 18.5486C3.55476 18.7346 3.58824 18.7933 3.73906 18.9036C3.87089 19 4.53323 19 5.85791 19H18.1415C19.4662 19 20.1286 19 20.2604 18.9036C20.4112 18.7933 20.4447 18.7346 20.4629 18.5486C20.4787 18.3861 20.0764 17.7056 19.2717 16.3447C18.5656 15.1506 17.9997 13.4818 17.9997 11.2Z"
            fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

    <!-- side menu (hamburger) -->
    <symbol id="i-menu" viewBox="0 0 24 24">
      <path d="M3 12H21M3 6H21M9 18H21" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>
  </svg>
  <!-- ===== /sprite ===== -->

  <div class="app {% block app_classes %}{% endblock %}" id="app">
    <!-- Sidebar (fixed menu) -->

    <aside class="sidebar" id="sidebar" style="overflow-y:auto; -webkit-overflow-scrolling:touch;">

      <div class="brand">
        <a class="brand-button" href="{% url 'user_dashboard' %}" title="Dashboard">
          <img src="{% static 'meta_search/images/logo_emoji.png' %}" alt="Dashboard" style="width:20px; height:20px; vertical-align:middle;">
        </a>
        <div class="brand-name"></div>
        <!-- Desktop-only toggle lives in the sidebar -->
        <button class="sb-toggle sb-toggle-desktop" id="sbToggleDesktop" aria-label="Collapse menu" title="Collapse">«</button>
      </div>

      {% static 'meta_search/images/avatar-placeholder.png' as avatar_placeholder %}
      <div class="profile"
           title="{{ request.user.nickname|default:request.user.get_full_name|default:request.user.username }}">
        <div class="avatar">
          {% if request.user.avatar %}
            <img src="{{ request.user.avatar.url }}" alt="User avatar" width="48" height="48" loading="lazy" onerror="this.src='{{ avatar_placeholder }}'">
          {% elif request.user.avatar_url %}
            <img src="{{ request.user.avatar_url }}" alt="User avatar" width="48" height="48" loading="lazy" onerror="this.src='{{ avatar_placeholder }}'">
          {% else %}
            <img src="{{ avatar_placeholder }}" alt="User avatar" width="48" height="48" loading="lazy">
          {% endif %}
          <span class="status-dot"></span>
        </div>
        <div class="meta">
          <div class="id">User ID: {{ request.user.id }}</div>
          <div class="phone">Phone: {{ request.user.phone|default:'-' }}</div>
        </div>
      </div>

      <nav class="nav" aria-label="Sidebar">
        <a class="link {% if active_page == 'home' %}active{% endif %}" href="{% url 'user_dashboard' %}" title="Home">
          <svg class="icon" aria-hidden="true"><use href="#i-home"/></svg>
          <span class="label">Home</span>
        </a>
        <a class="link {% if active_page == 'task' %}active{% endif %}" href="{% url 'task_dashboard' %}" title="Task">
          <svg class="icon" aria-hidden="true"><use href="#i-task"/></svg>
          <span class="label">Task</span>
        </a>
        <a class="link {% if active_page == 'rewards' %}active{% endif %}" href="{% url 'rewards' %}" title="Rewards">
          <svg class="icon" aria-hidden="true"><use href="#i-reward"/></svg>
          <span class="label">Rewards</span>
        </a>

        <h6>Account</h6>

        <a class="link {% if active_page == 'wallet' %}active{% endif %}" href="{% url 'wallet' %}" title="My Wallet">
          <svg class="icon" aria-hidden="true"><use href="#i-wallet"/></svg>
          <span class="label">My Wallet</span>
        </a>
        <a class="link {% if active_page == 'settings' %}active{% endif %}" href="{% url 'profile_settings' %}" title="Settings">
          <svg class="icon" aria-hidden="true"><use href="#i-settings"/></svg>
          <span class="label">Settings</span>
        </a>
        <a class="link {% if active_page == 'info' %}active{% endif %}" href="{% url 'info_index' %}" title="Info">
          <svg class="icon" aria-hidden="true"><use href="#i-info"/></svg>
          <span class="label">Info</span>
        </a>

        <div class="bottom">
          {% if request.user.is_authenticated and request.user.is_superuser %}
            <a class="link {% if active_page == 'admin' %}active{% endif %}" href="{% url 'admin_dashboard' %}" title="Admin Panel">
              <!-- Using lock as Admin Panel icon -->
              <svg class="icon" aria-hidden="true">
                <use href="#i-settings"></use>
              </svg>
              <span class="label">Admin Panel</span>
            </a>
          {% endif %}

          {# Built-in Django Admin (staff access) #}
          {% if request.user.is_authenticated and request.user.is_staff %}
            <a class="link" href="{% url 'admin:index' %}" title="Admin settings">
              <svg class="icon" aria-hidden="true"><use href="#i-settings"/></svg>
              <span class="label">Admin settings</span>
            </a>
          {% endif %}

          <a class="link" href="{% url 'signout' %}" title="Logout">
            <svg class="icon" aria-hidden="true"><use href="#i-logout"/></svg>
            <span class="label">Logout</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main panel -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <!-- Left: breadcrumb / menu -->
        <div class="breadcrumb">
          <!-- MOBILE-ONLY TOGGLE (drawer) -->
          <button class="sb-toggle sb-toggle-mobile" id="sbToggleMobile" aria-label="Menu" title="Menu">☰</button>
          <!-- (Optional) text trail on large screens -->
          <span class="crumb-home" aria-hidden="true">
            <svg class="icon sm" aria-hidden="true"><use href="#i-home"/></svg>
          </span>
        </div>

        <!-- Center: page title (new overridable block) -->
        <div class="title-center" role="heading" aria-level="1">
          {% block page_title %}{{ block.super|default:"" }}{% endblock %}
        </div>

        <!-- Right: bell -->
        <div class="bell" title="Announcements">
          <a href="{% url 'announcements' %}" aria-label="Announcements">
            <svg class="icon" aria-hidden="true"><use href="#i-bell"/></svg>
          </a>
          {# Optional badge: <span class="badge">3</span> #}
        </div>
      </div>

      <!-- Page content -->
      {% block content %}{% endblock %}
    </main>
  </div>

  {% block extra_scripts %}
  <script>
    // ===== Collapse & Mobile Off-canvas (two toggles) =====
    const appEl = document.getElementById('app');
    const sbToggleDesktop = document.getElementById('sbToggleDesktop'); // desktop: collapse
    const sbToggleMobile  = document.getElementById('sbToggleMobile');  // mobile: drawer

    function isMobile(){ return window.matchMedia('(max-width: 900px)').matches; }

    function setCollapsed(collapsed){
      appEl.classList.toggle('collapsed', !!collapsed);
      if (sbToggleDesktop){
        sbToggleDesktop.textContent = '☰';
        sbToggleDesktop.setAttribute('title', collapsed ? 'Expand' : 'Collapse');
      }
      try { localStorage.setItem('sb_collapsed', collapsed ? '1' : '0'); } catch(e){}
    }

    try {
      const saved = localStorage.getItem('sb_collapsed');
      if (saved === '1' && !isMobile()) setCollapsed(true);
    } catch(e){}

    sbToggleDesktop?.addEventListener('click', (e) => {
      e.stopPropagation();
      if (isMobile()) return;
      setCollapsed(!appEl.classList.contains('collapsed'));
    });

    sbToggleMobile?.addEventListener('click', (e) => {
      e.stopPropagation();
      if (!isMobile()) return;
      appEl.classList.toggle('nav-open');
    });

    document.addEventListener('click', (e) => {
      if (!appEl.classList.contains('nav-open')) return;
      const sidebar = document.getElementById('sidebar');
      if ((sidebar && sidebar.contains(e.target)) || e.target.closest('#sbToggleMobile')) return;
      appEl.classList.remove('nav-open');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') appEl.classList.remove('nav-open');
    });

    document.querySelectorAll('.nav .link').forEach(a=>{
      a.addEventListener('click', ()=>{
        if (isMobile()) appEl.classList.remove('nav-open');
      });
    });

    const mq = window.matchMedia('(max-width: 900px)');
    if (mq.addEventListener) {
      mq.addEventListener('change', () => {
        if (mq.matches) {
          appEl.classList.remove('collapsed');
          if (sbToggleMobile) sbToggleMobile.textContent = '☰';
        } else {
          appEl.classList.remove('nav-open');
          try { if (localStorage.getItem('sb_collapsed') === '1') setCollapsed(true); } catch(e){}
        }
      });
    }
  </script>

  <!-- ======== MOBILE BOTTOM NAV ======== -->
  <nav class="mobile-bottom-nav" role="tablist" aria-label="Primary">
    <a class="{% if active_page == 'home' %}active{% endif %}" href="{% url 'user_dashboard' %}" title="Home" role="tab" aria-selected="{% if active_page == 'home' %}true{% else %}false{% endif %}">
      <svg class="icon" aria-hidden="true"><use href="#i-home"/></svg>
      <span>Home</span>
      <span class="dot" aria-hidden="true"></span>
    </a>
    <a class="{% if active_page == 'task' %}active{% endif %}" href="{% url 'task_dashboard' %}" title="Tasks" role="tab" aria-selected="{% if active_page == 'task' %}true{% else %}false{% endif %}">
      <svg class="icon" aria-hidden="true"><use href="#i-task"/></svg>
      <span>Tasks</span>
      <span class="dot" aria-hidden="true"></span>
    </a>

    <a class="{% if active_page == 'rewards' %}active{% endif %}" href="{% url 'rewards' %}" title="Reward" role="tab" aria-selected="{% if active_page == 'rewards' %}true{% else %}false{% endif %}">
      <svg class="icon" aria-hidden="true"><use href="#i-reward"/></svg>
      <span>Reward</span>
      <span class="dot" aria-hidden="true"></span>
    </a>

    <a class="{% if active_page == 'wallet' %}active{% endif %}" href="{% url 'wallet' %}" title="Wallet" role="tab" aria-selected="{% if active_page == 'wallet' %}true{% else %}false{% endif %}">
      <svg class="icon" aria-hidden="true"><use href="#i-wallet"/></svg>
      <span>Wallet</span>
      <span class="dot" aria-hidden="true"></span>
    </a>
  </nav>
  <!-- ======== /MOBILE BOTTOM NAV ======== -->

  {% endblock %}
</body>
</html>
